!function(){"use strict";function t(t,i,e){for(var s,n,a=t,h=i,r=1;r<e&&(s=t*t)+(n=i*i)<=4;++r)i=2*t*i+h,t=s-n+a;return r}var i,e=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),n=function(t,i,e){var s=i("div",{className:"bar"});s.addEventListener("click",function(t){var i=t.target;"CANVAS"===i.nodeName&&e(i.dataset.id)});for(var n in t)s.appendChild(function(e){var s=i("canvas",{width:32,height:32});s.dataset.id=e;for(var n=t[e],a=s.getContext("2d"),h=0;h<32;++h){var r=n(8*h);a.fillStyle="rgb("+r[0]+","+r[1]+","+r[2]+")",a.fillRect(0,h,32,h)}return s}(n));return s},a={"sky-sun":function(t){if(256===t)return[255,255,255];var i=Math.abs(2*t-255)%256;return[i,i,256-i>>1]},bw:function(t){if(256===t)return[255,255,255];var i=Math.abs(2*t-255)%256;return[i,i,i]},"sky-sun-2":function(t){if(256===t)return[0,0,127];var i=Math.abs(t-255)%256;return[i,i,256-i>>1]},"bw-2":function(t){if(256===t)return[0,0,0];var i=Math.abs(t-255)%256;return[i,i,i]},green:function(t){if(256===t)return[255,255,255];var i=Math.abs(2*t-255)%256;return[i>>1,i,i>>1]}},h=function(){function h(t,i){var s=this;e(this,h),this.$=t,this.$.classList.add("fractal"),this.onDragMove=this.onDragMove.bind(this),this.onDragStop=this.onDragStop.bind(this),this.render=this.render.bind(this),this.renderSD=this.renderSD.bind(this),this._resize=this._resize.bind(this),this._save=this._save.bind(this),this.$canvas=i("canvas",{className:"fr"}),t.appendChild(this.$canvas),t.addEventListener("mousedown",this.onDragStart.bind(this)),t.addEventListener("mousewheel",this.onScroll.bind(this)),t.addEventListener("DOMMouseScroll",this.onScroll.bind(this)),this.ctx=this.$canvas.getContext("2d");var r=i("div",{className:"msg",innerHTML:"Drag to pan, scroll to zoom"});this.$.appendChild(r),setTimeout(function(){r.classList.add("min")},1e3),setTimeout(function(){r.remove()},5e3);var o=n(a,i,function(t){s.setPalette(t),s.render()});this.$.appendChild(o);var d=i("a",{className:"btn fa fa-arrows-alt",title:"Toggle Full Screen"});d.addEventListener("click",function(){s.toggleFullScreen(),s.render()}),this.sb=["home",d],this.title="Fractal"}return s(h,[{key:"bindEvents",value:function(){window.addEventListener("mousemove",this.onDragMove),window.addEventListener("mouseup",this.onDragStop)}},{key:"unbindEvents",value:function(){window.removeEventListener("mousemove",this.onDragMove),window.removeEventListener("mouseup",this.onDragStop)}},{key:"onScroll",value:function(t){i||(i={top:this.$canvas.offsetTop,left:this.$canvas.offsetLeft}),t.preventDefault();var e=Math.max(-.999,.001*-t.wheelDelta||.05*t.detail),s=((t.clientX-i.left)/this.width-.5)*this.dx,n=((t.clientY-i.top)/this.height-.5)*this.dy;this.xc-=s*e,this.yc-=n*e,this.dx*=e+1,this.dy*=e+1,clearTimeout(this.timerHD),this.renderSD(),this.timerHD=setTimeout(this.render,100)}},{key:"onDragStart",value:function(t){this.dragging=!0,this.dragX=t.pageX,this.dragY=t.pageY}},{key:"onDragMove",value:function(t){this.dragging&&(this.xc+=(this.dragX-t.pageX)/this.width*this.dx,this.yc+=(this.dragY-t.pageY)/this.height*this.dy,this.dragX=t.pageX,this.dragY=t.pageY,this.renderSD())}},{key:"onDragStop",value:function(){this.dragging&&(this.dragging=!1,this.render())}},{key:"i",value:function(){this.attached||(this.attached=!0,this.bindEvents()),this._load()}},{key:"s",value:function(){this.attached=!1,this.unbindEvents()}},{key:"render",value:function(){for(var i=this.dx/this.width,e=this.dy/this.height,s=this.imgData.data,n=this.xc-this.dx/2,a=0;a<this.width;a++,n+=i)for(var h=this.yc-this.dy/2,r=0;r<this.height;r++,h+=e){var o=this.palette(t(n,h,256)),d=a+r*this.width<<2;s[d]=o[0],s[d+1]=o[1],s[d+2]=o[2],s[d+3]=255}this.ctx.putImageData(this.imgData,0,0),setTimeout(this._save,100)}},{key:"renderSD",value:function(){for(var i=this.dx/this.width*2,e=this.dy/this.height*2,s=this.imgData.data,n=this.xc-this.dx/2,a=0;a<this.width;a+=2,n+=i)for(var h=this.yc-this.dy/2,r=0;r<this.height;r+=2,h+=e){var o=this.palette(t(n,h,256)),d=a+r*this.width<<2,l=d+4,c=d+4*this.width,u=c+4;s[d]=s[l]=s[c]=s[u]=o[0],s[d+1]=s[l+1]=s[c+1]=s[u+1]=o[1],s[d+2]=s[l+2]=s[c+2]=s[u+2]=o[2],s[d+3]=s[l+3]=s[c+3]=s[u+3]=255}this.ctx.putImageData(this.imgData,0,0)}},{key:"toggleFullScreen",value:function(t){this.isFullScreen="boolean"==typeof t?t:!this.isFullScreen,this.isFullScreen?(this._resize(),this.$.classList.add("fs"),window.addEventListener("resize",this._resize)):(this._resize(512,256),this.$.classList.remove("fs"),window.removeEventListener("resize",this._resize))}},{key:"_resize",value:function(t,i){this.$canvas.width=this.width="number"==typeof t?t:window.innerWidth,this.$canvas.height=this.height="number"==typeof i?i:window.innerHeight,this.dy=this.dx/this.width*this.height,this.imgData=this.ctx.createImageData(this.width,this.height)}},{key:"setPalette",value:function(t){var i=a[t];if(void 0===i)for(var e in a)return void this.setPalette(e);this.paletteName=t,this.palette=i}},{key:"getState",value:function(){return this.xc+","+this.yc+","+this.dx+","+this.paletteName+(this.isFullScreen?",fs":"")}},{key:"_save",value:function(){location.replace("#/fractal/"+this.getState())}},{key:"_load",value:function(){var t=location.hash.replace("#/fractal/","");if(t!==this.getState()){var i=t.split(",");this.xc=isNaN(i[0])?-.43:+i[0],this.yc=isNaN(i[1])?-.595:+i[1],this.dx=isNaN(i[2])?.1:+i[2],this.dy=this.dx/this.width*this.height,this.setPalette(i[3]);var e="fs"===i[i.length-1];e!==this.isFullScreen&&this.toggleFullScreen(e),this.render()}}}]),h}();x(h)}();
